Tracking the evolution of cookie-based tracking on Facebook

ABSTRACT

We analyze in depth and longitudinally how Facebook’s cookie-based tracking behavior and its communication about tracking has evolved from 2015 to 2022. More stringent (enforcement of) regulation appears to have been effective at causing a reduction in identifier cookies of non-users and a more prominent cookie banner. However, several technical measures to reduce Facebook’s tracking potential are not implemented, communication through the cookie banner and cookie policies remains incomplete and may be deceptive, and opt-out mechanisms seem to have no effect.

1 INTRODUCTION

Facebook1 has been one of the most scrutinized technology compa-nies with regards to user privacy. One aspect is its perceived ability to track both users and non-users online, primarily through the presence on third-party websites of embedded Facebook resources, such as its pixel and social plugins. Cookies are the main technical vector of concern, as they could allow to link website visits to a spe-cific person. Initially, Facebook initially stated that they “don’t use  for tracking and they’re not intended for tracking”, and provided transparency on its cookie usage . Facebook con-tributed detailed insights on its cookies to the 2011  and 2012  audits by the Irish Data Protection Commissioner. In 2011, after an independent researcher found that cookies persisted even after a user logged out, Facebook further explained the cookies they used and clarified that they were not intended nor used for tracking . Since then, with a shift to interest-based advertising, first in 2014 for its users  and later in 2016 also non-users, Face-book seemingly pivoted to tracking and profiling people across the web . Data protection authorities (DPAs) took note, and contin-ued investigating how Facebook uses cookies for potential tracking. In 2015, the Belgian DPA singled out the datr cookie as a track-ing vector in its recommendations and court cases, and demanded that Facebook stopped setting this cookie for non-users .

∗These authors contributed equally to this research. 1In October 2021, the parent company of the Facebook social network renamed itself from Facebook, Inc. to Meta Platforms, Inc., or Meta for short. Throughout this paper, we use the term Facebook to refer interchangeably to the website and the company that operates it.

WPES’22, November 7, Los Angeles, USA 2022. ACM ISBN 978-x-xxxx-xxxx-x/YY/MM...$15.00 https://doi.org/XXXXXXX.XXXXXXX

Facebook responded that this cookie was used only for security pur-poses and not tracking, but complied with the Belgian DPA’s order by disabling the datr cookie in Belgium, until the order was reversed in appeals . The French DPA fined Facebook in 2017 for “engag in unlawful tracking, via the datr cookie”, and again in 2022 for not allowing users to refuse cookies as easily as accepting them . Since then, new privacy legislation, such as the General Data Protection Regulation in Europe, imposed fur-ther restrictions on how Facebook can treat personal data, such as requiring consent for storing and collecting cookies. In this paper, we longitudinally measure the evolution of Face-book’s cookie-based tracking since the Belgian DPA order in 2015 until July 2022. We observe how Facebook responded to the DPA investigations and new privacy legislation, by analyzing when Face-book implemented changes to its cookie setting practices. We study in depth how both non-users and users2 may receive Facebook’s cookies, and subsequently become susceptible to tracking across the websites that incorporate Facebook’s third-party resources. Based on four technical reports of Facebook’s cookie usage, we see how Facebook has restricted its cookies for non-users over time. Whereas in 2015, Facebook automatically set cookies (including datr) whenever a non-user visited their website, by 2018, inter-action was required. In 2022, a cookie banner forces non-users to explicitly consent to cookies. This also has a cascading effect on tracking on third-party websites: whereas in the past, there had been scenarios in which Facebook would set and afterwards collect cookies that could uniquely identify a non-user, this is no longer the case. Facebook users received the fr cookie, used for targeted advertising, automatically in 2015, but can now reject this cookie if they decline ‘optional’ cookies. Despite this progress, certain aspects of Facebook’s cookie set-ting practices remain inadequate to guarantee privacy. The cookie banner only offers choices that will result in uniquely identifiable cookies being stored in the browser, including the datr cookie, which Facebook considers essential. This banner also appears to deploy dark patterns to trigger a more privacy-invasive choice. Moreover, despite the technical means to do so, Facebook does not restrict its identifier cookies to the facebook.com domain only. If a (non-)user accepted cookies from Facebook, these are therefore sent to Facebook on every visit to a third-party website with a Facebook resource. Finally, opting out of targeted ads does not appear to

2We use the term ‘users’ for people who have registered a Facebook account, and ‘non-users’ for people without a Facebook account (Section 2.2.1).

impact identifier cookies and the associated tracking capabilities for both non-users and users. Our work is designed as a case study of the dynamic nature of on-line tracking practices, and the effects of external pressure on user privacy. With our in-depth case study of Facebook’s cookie-based tracking over time, we complement the prior work that broadly analyzed tracking prevalence across the web . Our detailed and longitudinal analysis provides a unique view into how actions by legislators and regulators concretely impact tracking be-havior. Moreover, our study serves as a historical documentation of Facebook’s cookie policies and behavior; as we show, these change frequently and may therefore be difficult to observe retroactively. Our paper is structured as follows. We start with background (Section 2) and a description of our methods (Section 3). We then an-alyze tracking for non-users of Facebook (Section 4), studying which behavior causes cookies to be set, and how non-users are informed through a cookie banner and additional policy documents. After-wards, we compare with tracking for Facebook users (Section 5), studying cookie setting as well as how users can (re)configure their cookie settings. We conclude with a discussion on how Facebook’s cookie-based tracking evolved over time as a response to legal de-velopments (Section 6), and an overview of related work (Section 7).

2 BACKGROUND 2.1 Technical context: cookie-based tracking

2.1.1 HTTP cookies. Cookies add stateful information to the state-less HTTP protocol, e.g., for session management. A cookie is a small unit of (textual) data that is typically sent by a website to be stored inside a user’s web browser. Cookies can either be set through the Set-Cookie response header, or through JavaScript by modifying the document.cookie property. As a result, all cook-ies set by a website, will be automatically included in the Cookie request header for every subsequent request to that website, until the cookie expires.

2.1.2 First-party and third-party cookies. A web page hosted on a certain domain will typically embed resources hosted on other domains. For example, a page may include images or scripts hosted on a CDN. As mentioned before, the requests for those resources will contain the cookies set for the domain on which they are hosted. If the domain of the currently visited website (i.e., the domain in the browser’s address bar) and the domain of the loaded resource are the same, the request is said to be in a first-party context, and the cookies of that domain are referred to as first-party cookies . In a first-party context, a website (such as Facebook) can store cookies in the visitor’s browser and then collect them back on visits to a web page within that website’s domain (e.g., www.facebook.com). If the domains of the visited website and loaded resource differ, the request is said to be in a third-party context, and the cookies of the domain from which the resource is loaded are referred to as third-party cookies. Note that this third party is still unable to access the cookies of the first party, since cookies are restricted to a specific root domain. A third-party cookie can be used to track user visits across mul-tiple first-party websites, when those first-party websites all embed resources from the same third party . If such a cookie contains

a unique identifier for a user, that cookie and identifier will be sent along with all third-party requests, regardless of the first party that embeds the third party’s resource. The third party can therefore perform cross-site tracking to create a user profile, especially when the third-party request contains the URL of the first party’s web page, e.g., in the Referer header, or in a parameter of the request.

2.1.3 Security and privacy-related cookie attributes. Due to security and privacy issues where cookies in cross-site requests enable ses-sion hijacking or the leaking of information across websites, certain cookie attributes can restrict the type of requests that cookies are sent along with . The Secure attribute causes cookies to only be sent with requests made over a secure HTTPS connection. This prevents them from being intercepted by an intermediate party on the connection (‘manipulator in the middle’). If the cookie contains a unique user identifier, this would enable that party to track all requests by the user or act on their behalf. The SameSite attribute indicates in which contexts the cookie will be added to a (cross-site) request. When the value is Strict, cookies are only sent along with requests in a first-party context. Note that this means that cookies are not sent along with the first request to a site when navigating to that site through a link from another domain. When the value is Lax, cookies are sent along with requests in a first-party context and with top-level navigations to a website. If no SameSite attribute is set, modern browsers default to this Lax value. When the value is None, the cookies can be sent in a third-party context, i.e., also with requests for resources embedded on another website. In order to enable third-party tracking through cookies, a third-party domain must explicitly set this None value for its cookies .

2.2 Facebook context

2.2.1 Users versus non-users. We distinguish between Facebook users and non-users. Facebook users are Internet users who have explicitly registered an account on Facebook. These users can there-fore access the full functionality of the Facebook website. Non-users have not gone through such a registration process, therefore do not have a Facebook account, and as such cannot log in to Facebook.

2.2.2 Embedded Facebook resources. Facebook provides website developers with several resources that they can embed on their website to add functionality. Facebook subsequently operates in a third-party context on those websites, and could use third-party cookies to track visitors. In our analysis, we consider the following resources:

Facebook pixel/Meta pixel 3 allows to “track visitor activity on a website”. The website can call pixel functions to track events such as page visits, searches, or product purchases. In the remainder of the paper, we refer to this unambiguously as the Facebook pixel.

Social plugins 4 are a variety of buttons and plugins that enable social interactions from within a website. These include the ‘Like’ and ‘Share’ buttons to share a web page on Facebook, and the ‘Page’ plugin to embed a frame with page information.

3https://developers.facebook.com/docs/meta-pixel 4https://developers.facebook.com/docs/plugins/

Tracking the evolution of cookie-based tracking on Facebook WPES’22, November 7, Los Angeles, USA

2.3 Legal context

GDPR and cookies. In 2016, the European Union passed the Gen-eral Data Protection Regulation (GDPR), one of the strictest privacy legislations worldwide. The GDPR requires processing of personal data to have a specific legal basis, of which consent is the only appropriate basis for the purpose of online tracking and user profiling . On top of this, the ePrivacy directive, a lex specialis from 2002 that remains in force next to the GDPR, requires consent specifically for placing cookies that are not necessary or essential for providing a service. Therefore, consent must be ob-tained from the user, prior to the use of tracking cookies. The user must also be informed about the specifics of the data processing and their rights. In short, essential cookies (e.g., session cookies) do not require user consent, while this is required for cookies used for online tracking, profiling and advertising. Conditions for valid consent under the GDPR are strict. One of the requirements for consent is that it must be freely given, i.e., with a clear and affirmative action. For instance, presenting consent under the form of a pre-ticked checkbox, does not meet this requirement . Moreover, consent must be unambiguous and provided in an intelligible and easily accessible form and it must be as easy for the data subject to withdraw their consent as it is to give it. Consent may not be bundled together as a take-it-or-leave-it choice, but rather the user should be able to decide for which cookies they want to opt-in per type of cookie . The GDPR applies to all processing of personal data of European citizens, whether the company is EU based or not. Therefore, all businesses which provide a service in Europe, including Facebook, need to comply with the regulation.

Other soft law. In 2011, the Irish Data Protection Commissioner (DPC) audited Facebook’s data protection practices, at the time under the 1995 Data Protection Directive . The DPC recom-mended a.o., limiting data collection via social plugins, improving user privacy controls, and making the privacy policies simpler and more accessible. In the DPC’s 2012 re-audit, they found that “most of the recommendations ha been fully implemented”. In 2015, after a change in Facebook’s cookie and privacy pol-icy, the Belgian Privacy Commission (BPC; the predecessor of the Belgian DPA) fined Facebook, alleging that Facebook’s cookie us-age was in violation with the Belgian privacy law. The violations consisted of tracking with cookies of users and non-users of Face-book on websites with a Facebook social plugin without having obtained valid consent. They issued a recommendation, request-ing Facebook to cease all tracking of non-users as well as users with deactivated or deleted accounts, unless the web visitor had selected an unambiguous opt-in consent option. Facebook was also advised to offer privacy-friendlier social plugin integrations on third-party websites, which would not automatically send personal data through cookies to Facebook upon visiting the website. Face-book also had to provide more transparency about their cookies. The BPC updated their recommendation in 2017, since Facebook had changed their cookie practices after 2015. This recommenda-tion addressed roughly the same issues, in more depth. The court case is still ongoing in 2022 after a dispute over jurisdiction. We refer the interested reader to legal articles that give more context on the case proceedings .

Table 1: Reports considered for our in-depth analysis of Face-book cookies.

Measurement

Year Start End Country Reference

2015 2015-03-01 2015-03-31 Belgium  2017 2016-11-29 2017-02-23 Belgium  2018 2018-06-14 2018-07-06 Belgium unpublished 2022 2022-01-11 2022-02-22 Belgium unpublished

3 METHODS 3.1 Data collection

We base our in-depth analysis of the evolution of Facebook’s cookie setting practices on four technical reports (Table 1) that give a detailed description of observations of cookies set by Facebook, which were written for the Belgian DPA’s case. These reports cover scenarios such as the tracking of non-users, the tracking of Face-book users who are signed in or signed out, and the functioning of the ‘opt-out’ mechanisms proposed by Facebook. In general, these scenarios were analyzed through manual interactions with the Facebook website, executed in contemporaneous browsers and in virtualized environments that were reset between experiments to ensure a clean profile and isolate the effects of the interactions. A number of Facebook accounts were created for the experiments that required logged in users. Through a browser extension, every change (creation, modification, and deletion) to the cookie jar of the facebook.com domain was logged. Where relevant, the network requests to the facebook.com domain were examined through the browser’s developer tools.

3.2 Defining cookie-based tracking

Third-party web tracking, or behavioral tracking, commonly refers to practices that relate to the observation of browsing activity across multiple websites by a third party unrelated to those websites, although it is not a strictly defined term. Tracking breaks down into two major components: the technical ability to observe user activity, and the intent to actually record and use that activity. The term ‘tracking’ can then alternatively refer to only the ability, or both the ability and intent. The presence of the technical ability to track is relatively easy to measure: by analyzing whether third parties assign unique iden-tifiers to users, store those identifiers in the user’s browser, and collect those identifiers while users visit other websites, one can reasonably infer that those identifiers and visits could be collected and used to assemble a profile of one user’s behavior. Yu et al.  develop their approach on such a model of ability. As long as a service sends ‘unsafe’ data, defined as data that is only sent by a small number of users, they consider that there is a privacy risk for which mitigation is necessary. Coincidentally, they give Facebook’s datr cookie as an example of a cookie where the intent may not be tracking, but the uniqueness still provides the ability to track users, possibly unintentionally. Mayer et al.  also consider tracking as the collection of browsing history, and develop a model of po-tential harms that arise from such collection. Roesner et al. 

analyze the tracking capabilities of services, and state that they “do not distinguish between “can track” and “does track””. They give Facebook as an example of a ‘personal tracker’, i.e., a cross-site tracker that the user voluntarily visits directly, which causes the tracker-owned cookies to be set and then observed on other sites that include social plugins from that tracker. Conversely, analyzing the intent of web tracking is more diffi-cult: tracking companies essentially operate as a black box. The use of tracking for targeted advertising receives the most scrutiny, although tracking can also be used for less privacy invasive pur-poses . Through technical means, the use of browsing history to target ads could be inferred through audits and controlled ex-periments, although this may not constitute definitive proof. For example, multiple artificial user profiles could be built on certain online activity, after which the ads seen by those profiles can be analyzed to determine whether they are different between or tar-geted towards those profiles . Listings of user interests inferred through tracking, provided to users by trackers, serve as more explicit proof that tracking occurs and is used for ad target-ing . Finally, privacy or cookie policies can contain statements that a service builds and uses a user profile for ad targeting (or does not), although such statements could be incorrect or incom-plete, and the lack of such documentation does not confirm that observing browsing activity is not intended for or does not result in constructing a user profile. Even if a third-party service does not intend to track, other parties may still abuse the pres-ence of unique identifiers. For example, in their surveillance threat model, Englehardt et al.  discuss how passive eavesdroppers such as nation-state surveillance could track users by observing their unique third-party identifiers across multiple websites. Throughout our analysis, we discuss the cookies that Facebook sets and uses. To avoid an immediate classification as a ‘tracking cookie’, we designate ‘identifier cookies’ as an intermediate. We consider a cookie to be an identifier cookie if it meets two criteria: it must be persistent and uniquely identifying. We consider a cookie persistent if it remains stored in the browser for a sufficiently long period of time. The longer the cookie remains stored in the browser, the longer it can be used to track a single user, since the browser will send this cookie with every request to the website. In our anal-ysis, we use 90 days as a threshold for persistence; this value has also been used in prior work . We consider a cookie uniquely identifying if the value of the cookie is unique for one visi-tor, or is sufficiently specific (has sufficiently high entropy) that it is unlikely that two visitors will get the same value. This cookie can be used to link a request for a resource to one specific visitor, allowing to build the browsing history of that person across websites. Note that prior work has used the presence of such identifier cookies to label services as ‘trackers’, and our definition aligns with such a designation. Conversely, we cannot infer whether the cookie has a tracking intent from its lifetime and composition alone. In our discussion (Section 6), we assess in more depth whether there is any indication that Facebook uses (certain) cookies to profile users. A last element for assessing a service’s tracking potential is its reach. A tracker will only be able to build a meaningful user profile if it can observe visits across a large number of third-party websites. Facebook readily meets this requirement, having historically been

present as a third party on around a third of top websites .

3.3 Limitations

We select Facebook as a case study of online third-party tracking by a large technology company. Online tracking is supported by a large industry, among which figure most large online plat-forms. We do not compare Facebook’s cookie-based tracking to any other company’s tracking behavior, and make no statements about whether Facebook is better or worse at user tracking. Our analysis of potential tracking by Facebook is scoped to con-sider only cookie-based tracking. We therefore do not consider other technical forms of tracking which do not use cookies, such as browser fingerprinting, Adobe Flash cookies, ever-cookies, the HTML5 localStorage API, and CNAME-based tracking . We also do not consider tracking of user actions on Facebook’s site itself, nor the privacy implications of users volun-tarily sharing their data with Facebook on the platform itself . Our analysis relies on snapshots of Facebook’s cookie-related behavior. We therefore cannot observe changes in between, and do not have empirical evidence for the timing when changes ob-served from one report to another have been implemented. Where available, we complement our observations with external resources, such as blog posts or archived web pages, to more precisely pinpoint when Facebook implemented changes to its cookie-related behavior. Moreover, Facebook may change its behavior at any future time. The measurements in the reports that we analyze were all con-ducted on the desktop version of Facebook’s website. We therefore cannot observe tracking on mobile devices, either through the mobile version of the website (m.facebook.com) or the Facebook mobile app. On third-party websites, we did not interact with their cookie banners. We therefore do not observe whether accepting or rejecting (certain types of) cookies there affects cookie setting by Facebook. We base our findings on websites that – potentially despite a cookie banner – load Facebook resources and trigger requests to Facebook immediately upon page load. Our measurements are primarily conducted from Belgium. Face-book may adapt its tracking behavior depending on the jurisdiction, in particular since different legislation may apply. In our case, since Belgium is a European Union member state, the GDPR applies there. Moreover, some resources that we analyze are localized, in partic-ular in Flemish (Belgian Dutch). Some screenshots in this paper therefore show the Flemish version of Facebook’s website. To the extent where it is possible, we add the English version of these prompts by retrieving them from online resources such as publicly available screenshots.

4 NON-USERS OF FACEBOOK

In this section, we study whether Facebook stores cookies for a non-user, and how Facebook informs non-users about these cookies. First, we monitor which cookies were observed after a non-user vis-its Facebook’s website, using the home page as a proxy for any page on the facebook.com domain; visits Facebook’s privacy-related pol-icy pages; and visits other websites that include Facebook resources as a third party (Section 4.1). We focus on the most interesting cookies from a tracking viewpoint, i.e., cookies that can be used as

Tracking the evolution of cookie-based tracking on Facebook WPES’22, November 7, Los Angeles, USA

identifiers, or are otherwise related to a non-user’s privacy choice. For completeness, the overview in Table 2 lists all cookies that have been observed in at least one of the four analyzed reports, including session (i.e., non-persistent) cookies or cookies that are not suffi-ciently unique to be usable as an identifier. Next, we analyze how Facebook communicates about cookies through cookie banners, the main description of cookies that a regular non-user will see (Section 4.2). Finally, we analyze the full privacy-related policies that non-users (and users) can consult after following a link from the home page or cookie banner (Section 4.3).

4.1 Cookies set by Facebook

4.1.1 Visiting the Facebook homepage. In this scenario, a non-Facebook user visits Facebook’s homepage (www.facebook.com/) for the first time. In 2015, without any interaction, the page load automatically led to setting the datr cookie, with a 2-year lifetime and consisting of a 24-character random-looking string, therefore meeting our definition of ‘identifier cookie’ (Section 3.2). Facebook’s cookie policy states that the datr cookie “identifies browsers for purposes of security and site integrity, including for account recov-ery, and identification of potentially compromised accounts”. By 2018, Facebook had stopped setting cookies automatically upon page load. Instead, cookie setting depended on which parts of the page a user interacted with. The home page, which invites a person to create a Facebook account, contained certain zones which had a data-nocookies attribute set in HTML. Clicking any of these zones did not lead to cookie setting. These zones are marked in purple on Figure 1, and consist mostly of statements about and links to Facebook’s privacy-related policies, giving the appearance that a non-user is allowed to first read these policies without already receiving cookies. These zones were not visibly marked when visit-ing the page, and a non-user would have had to consult the HTML source code of the page to find the elements with a data-nocookies attribute that would not result in cookie setting upon interaction. Clicking outside the specially marked zones led to Facebook set-ting the datr cookie and, in contrast to 2015, also an sb cookie. This sb cookie has a 2-year lifetime and is a 24-character random-looking string, qualifying as an identifier cookie, similarly to datr. Face-book’s cookie policy states that the sb cookie “identifies browsers for login authentication purposes”. These cookies are set without the need to reload the page. The (future) values for datr and sb are sent in the body of the initial page load request as a DeferredCookie, and the cookies are set by an event listener upon clicking. This means that Facebook already assigns the unique identifier to the non-user upon page load, but only persists it to the browser once the non-user consents to cookie setting. In 2017 and 2018, when visiting the Facebook home page from another country, in this case France, an interaction similar to the one required to trigger the datr/sb cookies above also caused an fr cookie to be set. This fr cookie had a lifetime of 90 days and consisted of a 52-character random-looking string, qualifying as an identifier cookie. Facebook’s cookie policy states that the fr cookie is “Facebook’s primary advertising cookie, used to deliver, measure and improve the relevancy of ads”. The value for fr was sent in the body of the initial page load request as a DeferredCookie. In 2018, the fr cookie was also set from Belgium (after interaction) if the

Figure 1: The Facebook home page in 2018. If a non-user clicks zones marked in purple, no cookies are set. If a person clicks outside these zones, four cookies are set.

Facebook domain was visited through an advertisement seen when searching for the term ‘facebook’ in the Google search engine. This advertisement did not lead to the home page, but instead to the https://www.facebook.com/campaign/landing.php page. This suggests that Facebook may have applied a special, narrow con-figuration for its cookie setting behavior in Belgium, restricting cookies only for the home page. These observations also suggest that Facebook was both able and willing to adapt its potential track-ing behavior to specific countries and interactions. By 2022, the page load still did not automatically trigger cookie setting. Moreover, a cookie banner blocks any interaction with the login/registration form on the home page. We discuss the composi-tion of this cookie banner in more detail in Section 4.2.1. This cookie banner ultimately provides the non-user with two explicit choices: accept only essential cookies, or both essential and optional (i.e., ‘all’) cookies. A third option for the non-user would be to navigate away from the page and not accept any cookies at all. Without making an explicit choice, the non-user cannot continue using the home page. Selecting only essential cookies initially only results in the datr cookie being set, with the same lifetime, composition, and purpose as in 2015. Consequently, Facebook considers the datr cookie with its “security and site integrity” purpose essential to the operation of its website. However, upon reloading the page, the sb cookie is also set, with the same lifetime, composition, and purpose as in 2018 and 2015 respectively. Selecting essential and optional cookies initially also only results in the datr cookie being set; reloading also adds the sb cookie. As was the case in 2018, the values for datr and sb are still assigned upon page load and sent in the body of the initial request as a DeferredCookie. It appears that Facebook uses the presence of the datr cookie to determine

Figure 2: The Facebook data policy page in 2018. If a non-user clicks zones marked in yellow, four cookies are set. If a person clicks outside these zones, no cookies are set.

whether a non-user has consented to cookies, as deleting this cookie makes the cookie banner reappear. In summary, cookie setting for non-users who visit the Facebook home page for the first time evolved to require more (explicit) consent. While in 2015, merely visiting the home page resulted in uniquely identifiable cookies being set automatically, by 2017 cookie setting required interaction with the page, albeit under the assumption that any interaction except for consulting policy pages meant implicit consent to set cookies. By 2022, this consent has become more explicit, requiring a non-user to make an active choice to accept cookies before they can continue visiting (the home page of) Facebook.

4.1.2 Visiting policy pages. As mentioned above, the Facebook home page links to several pages that allow a non-user to consult Facebook’s policies related to privacy and cookies in more detail. We analyze these policies in more detail in Section 4.3. In 2015, cookies were set automatically upon loading the home page, so these cookies would naturally be set already whenever a non-user follows the links to the policy pages. A direct visit to the data policy page, without a prior visit to the home page, resulted in the datr cookie being set (for the first time). In contrast, in 2018, the zones on the home page with links to these policy pages were explicitly configured to not result in cookie setting. When following these links, initially no cookies were set either. However, some interactions with the policy pages would result in cookie setting, either directly or through redirection to other pages. In 2018, four links on the data policy page led to a page on research.fb.com, which loaded the Facebook pixel and caused an fr cookie to be set (Section 4.1.3). Clicking on the cross in the cookie banner, or the header with the Facebook logo (which would lead the non-user back to the home page) on both the cookie and data policy pages resulted in the datr and sb cookies being set. Clicking the whitespace to either side of (only) the data policy page also resulted in these cookies being set (Figure 2). In 2022, no interaction with the cookie or data policy pages ever led to cookies being set, except for clicking any of the two buttons in the non-blocking cookie banner at the bottom of the page (Section 4.2.2).

4.1.3 Visiting web pages with Facebook resources without a prior visit to Facebook. In this scenario, a non-user visits a website other than facebook.com that embeds any of the Facebook resources

listed in Section 2.2.2, without having visited facebook.com be-forehand. We analyze whether such visits may still result in cookie setting for the facebook.com domain, even though the non-user may not be aware that a Facebook resource has been loaded. In 2015, visiting a page with any of Facebook’s social plugins without a prior visit to Facebook’s home page initially did not result in any cookie being set. However, some social plugins requested additional resources on pixel.facebook.com, which led to the datr cookie being set. It appears that this domain is unrelated to the Facebook pixel. Loading the actual Facebook pixel did not cause any cookie setting. Moreover, certain websites loaded a script from connect.facebook.com, upon which the datr cookie was also set in a third-party position. In 2017 and 2018, visiting a page with any of Facebook’s social plugins without a prior visit to Facebook’s home page also did not result in any cookie being set. In contrast to 2015, loading the Facebook pixel did result in the fr identifier cookie being set in a third-party position. In 2022, visiting a page with any of Facebook’s social plugins without a prior visit to Facebook’s home page also did not result in any cookie being set. In contrast to 2017 and 2018, loading the pixel also does not result in cookie setting.

4.1.4 Visiting web pages with Facebook resources after a prior visit to Facebook or a page with Facebook resources. In this scenario, a non-user visits Facebook’s home page and then a third-party website with Facebook resources. This scenario combines the observations of first-party cookie setting by Facebook with the subsequent third-party collection of these cookies, which enables the ability to track. Alternatively, a non-user may have visited one third-party website with Facebook resources and then another third-party website with Facebook resources. If Facebook sets cookies on the former visit, it can collect them on the latter. In 2015, Facebook set the datr identifier cookie automatically when visiting the home page or a third-party website that made re-quests to connect.facebook.com or pixel.facebook.com. After such a visit, Facebook would collect this datr cookie on every visit to a third-party website with any Facebook resource. Moreover, for requests to connect.facebook.com, the URL of the visited page was included in the Referer header and sent to Facebook. As the Secure attribute was not set for this datr cookie, it would also be sent on non-HTTPS requests, i.e., in plaintext. The value of this cookie could therefore be trivially read by a passive traffic observer, allowing them to build a user profile . In 2017, Facebook set the datr, sb, and fr (outside Belgium) identifier cookies after interac-tion with the home page. The fr identifier cookie was also set when loading a third-party page with the Facebook pixel. On subsequent visits to sites with a social plugin, the URL of the visited page was included in the Referer header of the social plugin request. Only the sb cookie had the Secure attribute, meaning datr and fr could be intercepted from network traffic. In 2018, the datr, sb, and fr cookies were set in the same circum-stances as in 2017. On subsequent visits to sites with a social plugin, the URL of the visited page was included in the Referer header, and in the origin GET parameter of the social plugin request. The domain was also included in the domain GET parameter. On subse-quent visits to sites with a pixel, the URL of the visited page was included in the Referer header and in the dl GET parameter of

Tracking the evolution of cookie-based tracking on Facebook WPES’22, November 7, Los Angeles, USA

the pixel request. By 2018, all Facebook cookies had the Secure attribute, meaning they were never sent in plaintext anymore. In 2022, accepting essential cookies on the home page ultimately led to the datr and sb identifier cookies being set. On subsequent visits to sites with a social plugin, the URL of the visited page was included in href GET parameter of the social plugin request. The domain was included in the Referer header, since browser defaults for the Referrer Policy stripped the URL path from this header by 2022 . On subsequent visits to sites with a pixel, the URL of the visited page was included in the dl GET parameter of the pixel request. The domain was included in the Referer header. The datr and sb identifier cookies, alongside all other observed identifier cookies (c_user, fr, xs), all had their SameSite attribute set to None. This means that Facebook explicitly configured these cookies to be sent along with all third-party requests. The default Lax value would have stripped these cookies from those third-party requests. Facebook therefore has the technical ability to restrict cookies to only the first-party context of facebook.com via SameSite, but chooses not to do so. A non-user also has no way of accepting cookies only for first-party use. In summary, if a non-user previously received Facebook cookies, including identifier cookies, these will be sent along with every subsequent third-party request for a Facebook resource. Moreover, the URL of the visited page is sent along with this request, usually in multiple places. This allows Facebook to link the visit to the third-party page with the non-user’s unique identifier cookies, some of which Facebook deems essential. Across all third-party pages with Facebook resources that the non-user visits, Facebook would have the technical ability to build a profile of that user’s browsing activity, i.e., track that user.

4.1.5 Opting out of cookies. Throughout time, Facebook’s cookie policy has referred non-users who wanted to opt out of its tracking practices to the European Interactive Digital Advertising Alliance’s website5. Completing this opt-out process resulted in the setting of the oo cookie, which does not qualify as an identifier cookie, as it only contains a version number and optionally a timestamp. In 2015, Facebook set the datr identifier cookie during the status check of this opt-out process. Consequently, opting out actually caused an identifier cookie to be set (alongside the oo cookie). In other years, no additional cookies were set during the opt-out process. While the opt-out is registered through oo, we did not observe any difference in the set of identifier cookies that was stored or collected during any of the scenarios discussed above. This means that non-users who opted out still received and sent identifier cook-ies such as datr and fr (if applicable), alongside page URLs in the case of Facebook resources embedded in third-party pages (Sec-tion 4.1.4). Interestingly, in 2022, rejecting optional cookies through the cookie banner did not result in the oo cookie being set.

4.2 Cookie banner

4.2.1 Cookie banner on home page. The main method used for communicating to non-users about cookies and requesting their consent is the ‘cookie banner’ . In 2015, no such notice was present. In 2017 and 2018, a cookie banner (Figure 1) was placed at

5youronlinechoices.eu

the top of the page, just above the Facebook logo and login form. The text of this banner was in a relatively small font, on a dark blue background similar to the page header. The banner assumed consent upon any interaction of the non-user with the site, as observed in Section 4.1.1. Explicitly closing the cookie banner by clicking the cross was therefore one, but not the only trigger for cookie setting. In 2022, the cookie banner on the home page is blocking any other interaction with the home page (Figure 3): the cookie banner overlays the home page, and the non-user must make a choice be-fore being able to continue navigating the home page. As a result of this choice, cookies are placed (Section 4.1.1), unless the non-user leaves the page. We observed two versions of the blocking banner. The first version, observed in January 2022 was large enough to display the entire content of the first panel. The user then saw two buttons: on the left, a grey ‘More options’ button, and on the right, a longer blue ‘Allow all cookies’ button. Clicking ‘Allow all cookies’ closed the cookie banner, led to cookie setting, and allowed the user to continue browsing the home page. Clicking ‘More options’ opened a second panel, whose content overflowed the panel, i.e., a non-user would have to scroll to read the entire panel. This panel contained a brief explanation of essential cookies: “These cookies are required to use Facebook Products. They’re necessary for these sites to work as intended”. The cookies themselves were not de-scribed in further detail. Next to this explanation, a button was toggled on, and could not be toggled off. This was followed by a brief description of optional cookies, being “Cookies from other companies”. Next to this explanation, a button was toggled off, and could be toggled on. The banner continued with reasons to allow optional cookies, and “other ways  can control  information”. Finally, the user saw two different buttons: on the left, a grey ‘Only allow essential cookies’ button, and on the right, a blue ‘Allow selected cookies’ button. Selecting either option would result in cookie setting, with the cookies depending on the choice. The second version, observed in March 2022, combines the con-tent into one panel. Instead of buttons next to the descriptions of essential and optional cookies on the second panel in the first version, the non-user sees two buttons to select between both. On the left, there is a grey ‘Only allow essential cookies’ button, and on the right, a blue ‘Allow essential and optional cookies’ button. Compared to the 45 words in the banner of 2017, the explanation in the lone panel of the second version is much longer: in US English, 184 words are shown immediately, with an additional 557 words hidden under dropdowns. In all 32 languages in which the cookie banner can be shown, the frame of the cookie banner is too small to show the entire explanation, and a non-user must scroll down to read the rest of the description. The explanation for ‘essential cookies’ that a non-user sees on the home page is very brief, and nearly circular in reasoning: ‘essential’ cookies are ‘required’ to use Facebook and ‘necessary’ for the site to work as intended. The non-user does not know which cookies are essential, nor what they are used for, nor what their impact on the non-user’s privacy is. As we observed in Section 4.1.1, the essential cookies include the datr and sb cookie, which as identifier cookies may allow to uniquely identify a non-user on visits to third-party websites (Section 4.1.4). In addition, the layout of the selection buttons bears a strong re-semblance to a ’dark pattern’  as described in the guidelines

Table 2: Overview of cookies observed on the Facebook website. The description is sourced from the 2018 version of Facebook’s cookie policy, unless otherwise noted. ?: Cookie present. �: Secure flag set on cookie. SS: Value of the SameSite cookie attribute. E: Essential cookie. O: Optional cookie. EX: Listed as an example in the 2022 cookie policy. ID: Identifier cookie. *: session if “Keep me logged in” was unchecked, 1 month if checked.

Name Example value Description Expires after ? � ? � ? � ? SS E O EX ID

act 1529503857162%2F12 Timestamp and action counter  session ✓ ✗ ✓ ✗ ✓ ✓ ✗ – – – – ✗

csm 2 HTTPS needed for access to FB servers session/1 month* (2015), 90 days (2017)

✓ ✗ ✓ ✗ ✗ – ✗ – – – – ✗

c_user 100026475650953 User ID for account verification 90 days (2018), 1 year (2022)

✓ ✓ ✓ ✓ ✓ ✓ ✓ None ✓ ✓ ✓ ✓

datr XMgoW2nMBzOMLFvCAvIZXyMW Browser ID for security and site integrity 2 years ✓ ✗ ✓ ✗ ✓ ✓ ✓ None ✓ ✓ ✗ ✓

fr 096ZZfC5sBSEGN7BT.AWV5n1dp Tff1cOGQwCON8bQR5CE.BbJME S.Pt.AAA.0.0.BbJMES.AWUPcC3a

User/browser ID used to deliver, measure and improve relevancy of ads 90 days ✓ ✗ ✓ ✗ ✓ ✓ ✓ None ✗ ✓ ✓ ✓

lh en_US%2Cfr_FR Not listed in cookie policy 1 week ✗ – ✗ – ✓ ✓ ✗ – – – – ✗

locale fr_FR Region (country and language) 1 week ✓ ✗ ✓ ✗ ✓ ✓ ✓ None ✓ ✓ ✗ ✗

lu wfKm8ItfbXqRklNoERo10HlH Saved user ID and login data  2 years ✓ ✓ ✓ ✓ ✗ – ✗ – – – – ✓

oo v1%7C1%3A1529151909 Store ad opt-out 5 years ✓ ✗ ✓ ✗ ✓ ✓ ✓ None ✓ ✗ ✓ ✗

pl n Logged in via Facebook platform 90 days ✗ – ✓ ✓ ✓ ✓ ✗ – – – – ✗

p -2 User’s channel partition  session ✓ ✗ ✓ ✗ ✗ – ✗ – – – – ✗

pnl_data2 eyJhIjoib25hZnRlcmxvYWQiL CJjIjoiLyIsImIiOmZhbHNlLC JkIjoiLyIsImUiOltdfQ%3D%3D

Not listed in cookie policy 2 seconds ✗ – ✗ – ✓ ✓ ✗ – – – – ✗

presence EDvF3EtimeF1529135377EuserF A21B26475650953A2EstateFDu tF1529135377532CEchF_7bCC

Chat state  session ✓ ✓ ✓ ✓ ✓ ✓ ✓ not set; default: Lax

✓ ✓ ✓ ✗

reg_ext_ref https%3A%2F%2Fwww.google.com%2F Referer to first visited Facebook page  session ✓ ✗ ✓ ✗ ✓ ✓ ✗ – – – – ✗

reg_fb_gate https%3A%2F%2Fwww.facebook.com%2F First visited Facebook page  session ✓ ✗ ✓ ✗ ✓ ✓ ✗ – – – – ✗

reg_fb_ref https%3A%2F%2Fwww.facebook.com%2F Last visited Facebook page  session ✓ ✗ ✓ ✗ ✓ ✓ ✗ – – – – ✗

sb XMgoWzNEI74CKz6iY4CnPHz_ Identify browser for login verification 2 years ✗ – ✓ ✓ ✓ ✓ ✓ None ✓ ✓ ✓ ✓

s Aa67DZudqH2wPHl9 Timestamp of last password entry session/1 month* (2015), 90 days (2017)

✓ ✓ ✓ ✓ ✗ – ✗ – – – – ✗

spin r.4032753_b.trunk_t.1529598 307_s.1_v.2_ Not listed in cookie policy 25 hours ✗ – ✗ – ✓ ✓ ✗ – – – – ✗

wd 1920x869 Window dimension  session (2015/2017), 1 week (2018/2022)

✓ ✗ ✓ ✗ ✓ ✓ ✓ Lax ✓ ✓ ✓ ✗

xs 16%3ALXzrNJlk_Lys4Q%3A2%3 A1529135378%3A-1%3A-1 Session ID for account verification session/1 month* (2015), 90 days (2017/2018), 1 year (2022)

✓ ✓ ✓ ✓ ✓ ✓ ✓ None ✓ ✓ ✓ ✓

x-src %2Fdirectory%2Fpeople %2F%7Cpage_footer Analytics 1 second ✗ – ✓ ✗ ✓ ✓ ✗ – – – – ✗

of the European Data Protection Board . The layout appears to favor an option for which a user may be unaware that it may have a greater impact on their privacy. Specifically, in both versions of the 2022 cookie banner, the option that would also allow optional cook-ies is highlighted in a more prominent color (i.e., blue vs. grey). In the EDPB taxonomy, this color contrast may be classified as a ‘stir-ring’ pattern called ‘Hiding in plain sight’ . Moreover, in the first version, a non-user had to click through to another panel to decline optional cookies. (On this second panel, however, optional cookies were not toggled on by default.) In the EDPB taxonomy, this additional step may be classified as a ‘hindering’ pattern called ‘Longer than necessary’ . If cookie banners use such dark patterns, they may no longer be compliant with privacy law such as the GDPR .

4.2.2 Cookie banner on policy pages. In case a non-user visits the policy pages and has not yet consented to cookies, those pages may display a cookie banner to inform the non-user or allow them to make a choice. In 2015, Facebook did not use a cookie banner anywhere to inform users about cookies, and policy pages therefore did not include such a banner either. In 2018, both the data and cookies policy pages contained the same style of cookie banner as the home page, i.e., a small dark blue banner at the top of the

page, with a cross to dismiss the banner. In 2022, the data and cookie policy pages both had a cookie banner, but in contrast to the home page, this banner is non-blocking and only covers part of the bottom of the page. A non-user can still read the policy pages, without needing to consent to any cookies. The banner provided two buttons for the non-user to make a choice. In January 2022, these buttons read ‘Manage Data Settings’ (requiring to click through to accept only essential cookies) and ‘Accept All’ (accepting both essential and optional cookies). In March 2022, these buttons read ‘Allow all cookies’ and ‘Only allow essential cookies’ (Figure 4). In both versions, the wording of the buttons differs slightly from that used in the cookie banner on the home page. Possibly due to the banner’s smaller size, the description of cookies in the banner is also shorter than that on the home page, requiring a non-user to open additional modals to see the same information. Similar to the home page, the button to accept all cookies is more prominently colored (blue vs. grey), resembling a ‘dark pattern’ to nudge a non-user towards the more privacy-invasive choice. This banner style has since remained the same for the cookie policy page. On July 26, 2022, Facebook introduced a new privacy policy page. On this page, a cookie banner of the style of the home page is used, i.e, the banner blocks any interaction with the policy page, and the non-user is unable to read the privacy policy without

Tracking the evolution of cookie-based tracking on Facebook WPES’22, November 7, Los Angeles, USA

Table 3: Word counts, reading times (estimated at 200 words per minute), and Flesch Reading Ease (FRE) scores for the US English versions of Facebook’s cookie policy.

Date # words Estimated reading time FRE score

2016-05-26 1536 7’41” 43.0 2017-03-20 1536 7’41” 43.0 2018-04-04 1624 8’07” 43.0 2020-10-05 2126 10’38” 44.3 2021-06-23 2111 10’33” 44.1 2022-01-04 2109 10’33” 45.9 2022-07-26 (non-user, before accepting cookies) 2109 10’33” 45.9

2022-07-26 (non-user, after accepting cookies) 2126 10’38” 46.0

2022-07-26 (user) 2133 10’40” 45.9

consenting to at least essential cookies. The banner on the privacy policy page has the same contents as that on the home page, but is styled slightly differently. One artifact of this styling change is that the cookie policy link in this banner is indistinguishable from the rest of the text, being in the same color and font. A non-user would therefore be unlikely to find this link in the banner.

4.3 Policy documents

Facebook has two primary documents describing its privacy-related policies. Its Data Policy (before July 26, 2022) or Privacy Policy6

(after July 26, 2022) explains what personal data Facebook collects, how they collect it, and how they use and share that data. On the topic of cookies, this policy is complemented by the Cookies Policy7, which explains how cookies are used and what choices the user has. We mainly focus on this cookies policy throughout the rest of this section.

Revisions. Through the Internet Archive8, we retrieve the seven revisions of the cookie policy (Table 3). The current cookie policy mentions a revision date, and we recursively trace these revisions back to May 26, 20169, two days after the GDPR entered into force, and coindicing with the apparent expansion of user tracking for the Facebook Audience Network, its ad platform, to non-users . Overall, we find that the revisions are minor: fixing typos, updating domain names of third-party services, or updating ‘Facebook’ to ‘Meta’. The most significant change occurred in 2020, when cookie examples were interleaved with the policy (see “Access” paragraph below). Interestingly, the latest version of the cookies policy differs between non-users who have not accepted cookies (yet), non-users who have, and users, specifically in the “Manage your cookies” section. Non-users who have accepted cookies see an additional paragraph to “manage cookies from other companies on the Meta

6https://www.facebook.com/privacy/policy/ 7https://www.facebook.com/policies/cookies/ 8https://web.archive.org/ 9Before 2016, cookie-related policies and help information were hosted across different pages, without a revision date. We sample pages archived on the Internet Archive from before 2016 to discover further policy documents relating to cookies.

Products on this browser”, which when clicked opens a modal where non-users can allow or revoke these (optional) cookies. The circuitous route through a modal linked at the bottom on the cookies policy page (linked from the homepage) is the only way for non-users to revoke their consent for optional cookies. On the other hand, whether a non-user accepts optional cookies or not, does not affect the cookies set by Facebook, until they actually become a Facebook user and log in. Facebook users see another paragraph instead, linking them to Facebook’s cookie settings page, where they can change their cookie preferences for two types of optional cookies (Section 5.2).

Readability. We analyze how much effort a person would have to invest to read and understand the cookies policy, which would allow them to give genuinely informed consent to cookies. Over time, Facebook’s cookie policy has gotten longer (Table 3), starting at over 1,500 words in 2016 and having reached over 2,100 words by 2022. Translated into reading time, estimated for a reading speed of 200 words per minute, it would take a person up to 10 minutes and 40 seconds to read the latest version of Facebook’s cookie policy. Finally, the Flesch Reading Ease score, a readability metric which typically ranges from 0 to 100 and for which higher scores indicate a more readable text, increased from 43.0 to 46.0 between 2016 and 2022. This means that the cookies policy became slightly easier to read over time, but in general it is still interpreted as a difficult text to read. However, such difficulty levels are common among online privacy-related policies. In 2018, Facebook’s privacy policy was actually the most readable among prominent third parties, albeit with a score of 48.94, with the average privacy policy of these third parties having a score of 35.48 .

Access. Since at least 2011, the privacy policy page has been linked from the footer of the home page, joined in June 2012 by a link to the cookies policy page. When launching the new cookies policy page on May 26, 2016, Facebook’s home page even highlighted the link with a note that “We’ve updated our policy.” In 2018, the home page continued to provide these links to the data, and non-users could visit these pages without receiving cookies, as clicking these links was an interaction exempted from automatic cookie setting (Section 4.1.1). In 2022, these links still appear in the footer, but with the blocking cookie banner on the home page (Section 4.2.1), a non-user cannot access these links without accepting cookies. Instead, the cookie banner contains a link to the cookie policy page. The data or privacy policy page can only be accessed indirectly through a link on that cookie policy page, and is therefore no longer directly accessible from the home page to a non-user who has not accepted cookies.

Cookie details. One feature of the cookie policy is a detailed overview of which cookies are used by Facebook. Until May 11, 2012, no such overview was given on the help pages about cookies. At this time, the most accurate knowledge of Facebook cookies originated from the Irish DPA audits of Facebook’s privacy practices  and from a comment by a Facebook engineer on a blog post . From May 11, 2012 until May 26, 2016, an overview was available through a link on the cookie policy page to the Irish DPA audits, which listed all cookies observed on Facebook during in the audit. For each cookie, the document gave a relatively lengthy and

detailed description of its purpose, which was provided by Facebook at the request of the DPA. From May 26, 2016 until October 5, 2020, the cookie policy page provided a modal containing a table with a detailed overview of all cookies, grouped by permanent and session cookies, and by the general purpose of the cookie. For each cookie, the table listed the expiration time, the composition of the cookie, and its detailed purpose. Despite this detailed overview, it appeared that in 2018 it was not complete: we observed three cookies (lh, pnl_data2, and spin) that were not listed in the cookie policy, and for which there was therefore no description available. While the maximum lifetime for these cookies was 1 week, and we therefore do not consider them identifier cookies, they do indicate that the cookie overview cannot be assumed as an authoritative source of Facebook’s cookie practices. Indeed, the overview modal admits that the cookies used by Facebook may differ from those described in the overview table. On October 5, 2020, the cookie policy page was updated to re-move the modal with the detailed table. Instead, explanations of the cookies’ general purposes are interleaved with examples, which sometimes list concrete cookie names, lifetimes, and purposes. Ta-ble 2 lists which specific cookies are given as examples. We never observed five of the listed cookies (csrf, dbln, dpr, _fbc, _fbp), possibly due to our measurements being limited to the desktop web-site from Belgium (Section 3.3). Of these cookies, the _fbc cookie is stated to have a 90-day lifetime, and to be used for “identif browsers”. This suggests that it may also have met our definition of identifier cookie. Conversely, in 2022, we observed two cookies that were not mentioned nor explained anymore in the cookie pol-icy, despite them being present in the 2018 overview table. These cookies are the locale cookie and, notably, the datr cookie, which is an identifier cookie. Moreover, the policy does not explain which cookies are considered ‘essential’ or ‘optional’, and it appears that such detail cannot be found anywhere. Without such an overview, it is impossible to verify whether a person’s choice to only allow ‘essential’ cookies is honored: a person cannot compare the cookies that they have received to a list of cookies that Facebook claims to be essential.

5 USERS ON THE FACEBOOK WEBSITE

In this section, we study whether Facebook stores cookies for a registered user. We analyze how cookies are set and removed when logging in and logging out respectively. Then, we describe which (additional) cookie controls Facebook provides to its users.

5.1 Cookies set by Facebook

Logging into Facebook. In 2015, when a Facebook user logged into their account, the c_user, datr, fr, and xs cookies were set (Table 2), all qualifying as identifier cookies. While datr (and in some cases fr) would have already been set upon visiting the home page with the login form, c_user is only set for users, as it con-tains the user’s Facebook ID and is stated to be used for account verification. In 2017, these cookies were joined by the sb cookie, an identifier cookie. In 2018, the lu cookie was no longer used. The most notable change relates to the use of the fr identifier cookie, the only cookie that is explicitly related to online adver-tising and personalised content, according to the cookie policy of

Facebook. In 2022, the fr cookie is only placed upon consent for non-essential cookies, which the user can indicate by selecting “Allow essential and optional cookies” in the cookie banner on the Facebook homepage (Section 4.2). The user can also decline non-essential cookies by selecting the option “Only allow essential cookies” on the cookie banner. In that case, an opt-out cookie called oo is set instead of the fr cookie. Facebook’s cookie policy states that oo “help you opt out of seeing ads from Meta based on your activity on third-party websites”. The mentioned identifier cookies are sent to Facebook when a user visits a web page with a Facebook resource, along with the URL of the visited website (Section 2.2.2). Since 2022, this no longer holds for the fr cookie whenever the oo cookie is set.

Logging out of Facebook and deactivating a user account. Upon logging out, the c_user cookie (for account verification) and the xs cookie (a session ID), both identifier cookies, are always deleted. However, the remaining cookies, among which the advertising cookie fr up to 2018, are retained even after the browser is restarted and are sent to Facebook on sites which include a Facebook resource, along with the URL of the site. Since 2022, the fr cookie is deleted when the user logs out, which was previously not the case. The ones that remain stored in browser are the datr and sb identifier cookies, therefore still making it possible for Facebook to track logged-out users across different websites.

5.2 Cookie settings for Facebook users

Visual elements. Right after a user registers a new Facebook ac-count and logs in for the first time, a cookie settings menu is shown to the user (Figure 5). The settings shown in this menu are some-what similar to the cookie banner shown on the homepage before the user is logged in (Section 4.2). However, instead of only two cat-egories of cookies (essential and optional cookies), Facebook allows the user to choose separately whether to allow optional Facebook cookies on other apps and websites, and third-party cookies from other companies. The former category is described as “cookies that help other companies to share information with us about your activ-ity on their apps and websites”, and is used for personalization and targeted advertising, but also for social plugins and other services such as Facebook login. Cookies from other companies are used for “advertising and measurement services off Facebook Products, analytics, and to provide certain features and improve services”. The user does need to scroll down in order to read the description of all three categories of cookies, since the settings banner does not fit on one page. We note that any first-party statistics or analytics performed by Facebook are not mentioned in this cookie banner. Furthermore, the explanation provided for the category of essential cookies is short, the exact set of essential and both types of optional cookies is not mentioned, and the implications of the use of such cookies remain unclear to the user. In January 2022, we observed a difference for the cookie settings shown to newly registered users. Back then, the user was immedi-ately given only two options: click on an “Allow all cookies” or a “More Options” button. The latter leads the user to a second panel, where the user can manually select their cookie preference from the same three categories as previously described (essential and two types of optional cookies). This design choice requires the user

Tracking the evolution of cookie-based tracking on Facebook WPES’22, November 7, Los Angeles, USA

to perform an additional click in order to reject optional cookies, resulting in it being easier to allow all cookies than to select only essential cookies. On top of that, the button which allows all cook-ies is highlighted in a more prominent blue color, which the button used to manage cookies has a grey color. Even though the text on the buttons changed by March 2022, the dark pattern concerning the colors of the buttons remains, just like in the cookie banner that is shown to users visiting the Facebook homepage without being logged in (Section 4.2.1). However, the change makes rejecting all optional cookies as easy as accepting them for Facebook users, and the optional cookies are deselected by default.

Changing the cookie settings. The cookie settings are shown to the user on the first ever login with their Facebook account, i.e., no longer on any subsequent Facebook visit. If the user wishes to change their cookie settings, in 2022, they can do this through the “Cookies” tab in the Settings menu, where they can make a new choice for either category of optional cookies (Figure 6). Essential cookies are also listed, but the toggle switch is on by default and cannot be changed. These cookie settings are also linked to from the cookies policy (Section 4.3). A similar process was available in 2018, where users could opt out of (cookies for) the Facebook Audience Network, which was enabled by default for all users. When a Facebook user visits the homepage with a clean browser state (i.e., previously set cookies have been deleted), the user is once again shown the cookie banner. However, according to their cookie preferences, the Facebook user has adjusted the cookie settings of their account (which are only available to logged in users) in a previous visit, which might differ from the choice that the user can select in the cookie banner on the homepage. In such cases, we examine which settings will apply and which cookies are set. Even if the user has selected to allow all cookies in their account, if they choose only essential cookies in the cookie banner before logging in, only essential cookies will be retained in the browser and the oo cookie will be set instead of the fr cookie. Thus, the indicated choice in the cookie banner will override any cookie settings from the user account for the current browser session. Only when the user accepts non-essential cookies in the cookie banner and has set their profile settings to allow all non-essential cookies, will the fr advertising cookie be set. Facebook users can also use the external European Interactive Digital Advertising Alliance website to opt-out of Facebook tracking, which will have the same effect as for non-users (Section 4.1.5).

6 DISCUSSION

Our analysis shows that over time, Facebook has become more cautious in setting cookies for non-users, reducing the potential for these non-users to be tracked by Facebook. While in 2015 visiting the Facebook website and sometimes even third-party websites that loaded Facebook resources could result in cookies automat-ically being set, Facebook has since started requiring interaction as a signal of consent (Section 4.1.1), at least in the European re-gion . It appears that the difficulty of asking for such consent on third-party websites  has also caused cookie setting to be eliminated by 2022 when loading any of the Facebook resources listed in Section 2.2.2 (Section 4.1.3). The datr cookie, which was the main subject of scrutiny in the past, is therefore

also no longer set for non-consenting non-users (i.e., those who do not select any option on the cookie banner), conforming to the recommendations of the Belgian DPA . Facebook also appears to consider the pages with the privacy and cookies policy as special resources that non-users must be able to access without the need to consent to cookies (Section 4.1.2). However, on some occasions, Facebook does appear to nudge non-users towards accepting all of its cookies. Access to most of the Facebook website is prevented by a cookie banner which can only be dismissed by a non-user consenting to at least ‘essential’ cookies, including the datr cookie, without mention of which cookies are deemed essential. Moreover, this cookie banner appears to deploy ‘dark patterns’ to entice non-users into making a more privacy-invasive choice, by making the button to accept all cookies more prominent (Section 4.2.1). Regulatory action has proven effective to reduce these ‘dark patterns’. The French DPA gave Facebook a 60 million euro fine for making rejecting optional cookies a more labo-rious process than accepting them . Indeed, we saw in January 2022 that rejecting optional cookies required navigating two panels as opposed to one click for accepting them (Section 4.2, Section 5.2). In response, Facebook updated the cookie banner to make a button to accept only essential cookies available in its first (and only) panel, as we saw in March 2022, to the satisfaction of the French DPA . A similar evolution is to be seen in the cookie settings which Face-book users can access after logging in. However, the button for rejecting all non-essential cookies remains more prominent in both the cookie banner and the cookie settings interfaces. Facebook’s process to require non-user consent also appears to sometimes introduce artifacts. In 2018, cookie setting differed by the parts of the home page with which a user interacted (Section 4.1.1). At the time of writing (July 2022), non-users must accept at least essen-tial cookies to read the new version of Facebook’s privacy policy (Section 4.2.2). Facebook has also improved communication about cookies to non-users by adding a cookie banner in 2017. They may have done this to comply with the GDPR, as has been observed on other web-sites . By 2022, this cookie banner blocked a non-user from further interaction with Facebook’s website. Indeed, in 2021 Face-book announced that they would roll out “a new consent prompt”, to “align with evolving privacy requirements, such as the  GDPR and the ePrivacy Directive” . This roll-out also added granu-lar settings for Facebook cookies on other apps and websites, and third-party cookies from other companies, albeit only for regis-tered users (Section 5.2). This cookie banner provides a short and generic description of the purposes and uses of cookies by Facebook. Non-users are referred to Facebook’s cookies policy for more infor-mation. While this policy is relatively easy to read compared to its industry peers, it is overall still a difficult and long text that requires significant effort to read and understand (Section 4.3). However, the level of available detail with regards to cookies has actually decreased over time: since 2020, the cookies policy only gives ex-amples of certain cookies instead of a full overview table. The datr cookie is no longer listed in this new cookies policy version, despite the 2017 recommendation from the Belgian DPA that “Facebook should offer full transparency on the use of cookies” and “specify for each cookie separately the content  and purpose ” . This

makes it difficult for both users and non-users to fully understand the implications of their privacy settings. As described in Section 3.2, we primarily assess whether cook-ies could be used as identifiers, i.e., whether they are persistent and uniquely identifiable. Over time, we observed six cookies that meet this definition (Table 2). Five of these relate to authentication, account verification, and security. Of these, two are set for non-users (datr, sb), and three for logged-in Facebook users (c_user, lu, xs). When a registered user logged out, the datr and sb cookies remained stored on the user’s device, joined until 2018 by the lu cookie, although the user ID component was stated to be removed from the lu cookie . Because of the SameSite attribute be-ing explicitly set to None by Facebook for these cookies, they will be sent along with requests to Facebook on third-party websites (e.g., for embedded social plugins), contrary to the 2017 Belgian DPA recommendation . The identifying nature of these cookies, combined with page URLs also being sent along with third-party requests, enables the technical ability to use them for tracking. Whether the intent to use these cookies for tracking and building a user profile is present or even necessary to be harmful can be a matter of debate. To an extent, some of these cookies may only be useful if they build some form of profile, e.g., monitoring suspicious login behavior, even though this profile is not necessarily used for personalization. This reflects a tension between data protection and vulnerability to certain security threats . However, at the moment, a web visitor has no choice but to accept that Facebook has configured its identifier cookies in such a way that Facebook can access them on third-party websites, even though first-party-only cookies (using SameSite) might yield a better balance between privacy and security. Regardless, the presence of these identifiers may induce a risk of unintentional data collection and tracking, future profiling, or surveillance by a passive observer . The fr identifier cookie is more ostensibly intended for tracking and profile building, as Facebook states it is used for “improv the relevancy of ads”, i.e., ad targeting. This form of tracking and profiling is more commonly accepted as being harmful for privacy, and people are concerned about the data collection and profiling for the purpose of behavioral advertising . Facebook’s use of the fr cookie has evolved alongside its ad targeting practices. In May 2016, Facebook expanded its Audience Network ad plat-form to non-users, with the apparent goal of “show better ads to everyone” . We hypothesize that this expansion may have coincided with the fr cookie being set for non-users. Indeed, in our 2017 and 2018 measurements, we see at least some scenarios where non-users receive the fr cookie, as opposed to 2015 when this was only the case for registered users, albeit not when visiting the Facebook home page from Belgium. This last observation may have been a result from the Belgian DPA’s case against Facebook’s cookie practices. By 2022, the fr cookie is once again gone for non-users, and is only set as an ‘optional’ cookie for users. This change is seemingly caused by Facebook shutting down support for social plugins in the European Region for non-users  and stopping to serve targeted ads from Audience Network to non-users and users who reject optional cookies . In contrast to before, the fr cookie is also deleted for registered users when they log out.

7 RELATED WORK

In general, online tracking has been studied extensively in prior work, usually measuring its prevalence across the web . Bujlow et al.  survey web tracking threats, mechanisms and defenses. Lerner et al.  studied the historical evolution of tracking in particular, measuring cookie-based third-party tracking from 1996 to 2016 using the Internet Archive. They found an in-crease in tracking across the top 500 websites over time, and note how tracking through social media widgets like Facebook’s social plugins was an emerging phenomenon. A number of studies have evaluated the impact of the GDPR on online privacy. In the area of online tracking, the general findings show that the introduction of the GDPR has lead to a decrease in the number of third-party tracking cookies being used  and has even had an effect outside of Europe, although Sørensen and Kosta find no clear effect . Privacy policies have become longer as a result of the GDPR, but therefore also have a higher coverage of privacy-related topics and are more likely to be compliant . Cookie banners have also become a staple . However, their design often contains dark patterns, which might even introduce legal violations . Jha et al.  find that online tracking increases greatly after accepting all cookies in a cookie banner. Kretschmer et al.  surveyed recent work on the impact of the GDPR on cookie banners and privacy policies. Specifically concerning technical evaluations of cookies set by Facebook, Cubrilovic  found that certain cookies, among which the datr cookie, were not deleted when logging out of Facebook. Roosendaal  discusses third-party cookie setting by Facebook in 2012, across scenarios where a person does or does not have a Facebook account. They also describe how this may harm an individual’s privacy and identity. Shore and Steinman  study the evolution of Facebook’s privacy policy from 2005 to 2015. To our knowledge, no study examines historically Facebook’s cookie setting practices for both users and non-users across both Face-book’s own website and third-party websites in recent time. We provide an updated and longitudinal view of Facebook’s cookie set-ting behavior, contextualize it with recent developments in privacy regulations and Facebook’s tracking practices, and analyze these cookies and their potential for tracking in more depth.

8 CONCLUSION

Through a longitudinal and in-depth case study, we analyzed how Facebook’s cookie-based tracking behavior evolved from 2015 to 2022. While tightened privacy regulations appear to have positively impacted tracking behavior for non-users, Facebook still appears to go beyond what is strictly necessary for its operations, such as not limiting identifier cookies to a first-party context, nudg-ing (non-)users towards more privacy-invasive options through dark patterns, or cookies being seemingly unaffected by opt-outs. Given increasing regulatory pressure, including ongoing investi-gations, these practices are likely to remain the subject of scrutiny in future. However, this can have the positive effect of further compliance with privacy law, a reduction in online tracking, and therefore a better preservation of people’s privacy online.

Tracking the evolution of cookie-based tracking on Facebook WPES’22, November 7, Los Angeles, USA

ACKNOWLEDGMENTS

We thank the authors of the 2015 and 2017 reports. This research is partially funded by the Research Fund KU Leuven, and by the Flemish Research Programme Cybersecurity. Victor Le Pochat holds a PhD Fellowship of the Research Foundation Flanders -FWO (11A3421N).

REFERENCES

An Interaction Criticism Perspective. In 2021 CHI Conference on Human Factors in Computing Systems (CHI ’21) Article 172, 18 pages. doi: 10.1145/3411764.344 5779.

by the Irish Data Protection Commissioner. FTR Solutions, (Sept. 21, 2012). https://web.archive.org/web/20130208064544/https://dataprotection.ie/docu ments/press/Facebook_Ireland_Audit_Review_Report_21_Sept_2012.pdf.

Tracking the evolution of cookie-based tracking on Facebook WPES’22, November 7, Los Angeles, USA

A FIGURES

Figure 3: Cookie banner on the Facebook home page in July 2022. The banner blocks any interaction with the rest of the home page.

Figure 4: Cookie banner on policy pages in July 2022.

Figure 5: Cookie settings shown to newly registered Facebook users on their first login in July 2022.

Tracking the evolution of cookie-based tracking on Facebook WPES’22, November 7, Los Angeles, USA

Figure 6: Cookie settings menu available to registered Face-book users in July 2022.

